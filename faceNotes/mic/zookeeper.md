


### Zookeeper中的Watch机制的原理？

资料来源：[ Zookeeper中的Watch机制的原理？](https://www.toutiao.com/video/7090044424264090120/)

一个工作了 7 年的粉丝， 遇到了一个 Zookeeper 的问题。

因为接触过 Zookeeper 这个技术， 不知道该怎么回答。
我说一个工作了 7 年的程序员， 没有接触过主流技术， 这不正常。
于是我问了他工资以后， 我理解了！
好吧， 关于“Zookeeper 中 Watch 机制的实现原理”， 看看普通人和高手的回答。  


#### 高手

好的， 这个问题我打算从两个方面来回答。
Zookeeper 是一个分布式协调组件， 为分布式架构下的多个应用组件提供了顺序访问控制能力。
它的数据存储采用了类似于文件系统的树形结构， 以节点的方式来管理存储在Zookeeper 上的数据  

![image-20231225163949209](img/image-20231225163949209.png)

Zookeeper 提供了一个 Watch 机制， 可以让客户端感知到 Zookeeper Server上存储的数据变化， 这样一种机制可以让 Zookeeper 实现很多的场景， 比如配置中心、 注册中心等。  

![image-20231225164023282](img/image-20231225164023282.png)

Watch 机制采用了 Push 的方式来实现， 也就是说客户端和 Zookeeper Server会建立一个长连接， 一旦监听的指定节点发生了变化， 就会通过这个长连接把变化的事件推送给客户端。
Watch 的具体流程分为几个部分：
首先， 是客户端通过指定命令比如 exists、 get， 对特定路径增加 watch
然后服务端收到请求以后， 用 HashMap 保存这个客户端会话以及对应关注的节点路径， 同时客户端也会使用 HashMap存储指定节点和事件回调函数的对应关系。
当服务端指定被 watch 的节点发生变化后， 就会找到这个节点对应的会话， 把变化的事件和节点信息发给这个客户端。
客户端收到请求以后， 从 ZkWatcherManager 里面对应的回调方法进行调用，完成事件变更的通知。  

![image-20231225164107869](img/image-20231225164107869.png)

以上就是我对这个问题的理解！
#### 面试点评
这个面试题呢， 我认为考察的价值也很大， 其实对于服务端的数据变更通知，无非就是 pull 和 push 两种方案， 而这道题里面涉及到的技术点就是 push 的实现。
在业务开发里面， 也可能会涉及到类似的场景， 比如消息通知， 扫码登录等。
如果你了解这些思想， 那在解决这类问题的时候， 会变得更加从容。
好的， 本期的普通人 VS 高手面试系列的视频就到这里结束了。
我是 Mic， 一个工作了 14 年的 Java 程序员， 咱们下期再见。  


<hr>


### 谈谈你对Zookeeper的理解

资料来源：[谈谈你对Zookeeper的理解，普通人和高手有什么区别？](https://www.toutiao.com/video/7031460439535911460/)

<hr>

### 为什么Zookeeper集群的节点都是单数？

资料来源：[【Java面试】为什么Zookeeper集群的节点都是单数？](https://www.toutiao.com/video/7290116854083912203/)
<hr>