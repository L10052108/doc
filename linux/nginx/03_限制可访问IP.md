资料来源：<br/>
[如何用 Nginx 代理 MySQL 连接，并限制可访问IP？](https://mp.weixin.qq.com/s/6lvKIQb4yk7uTmufr9pJ8w)





## 限制访问IP

实现了对连接的代理，所有人都可以通过访问Nginx来连接MySQL服务器，解决了外网无法连接的问题。

为了更进一步的缩小访问范围，保证数据安全，我们可以限制只有公司网络的IP地址可以通过Nginx进行连接。

Nginx提供了`ngx_stream_access_module`模块，其指令非常简单，仅包含allow和deny指令。

### allow

该指令设置指定的IP允许访问。可以和deny指令配合使用

- 作用域：stream, server
- 语法：allow address | CIDR | unix: | all;

示例：

```
 # 允许192.168.110.1访问
 allow 192.168.110.1;
 
 # 允许192.168.110.1到192.168.255.254
 allow 192.168.110.0/16;
 
 # 允许192.168.110.1到192.168.110.254
 allow 192.168.110.0/24;
 
 # 允许所有的IP访问
 allow all;
```

### deny

该指令设置指定的IP禁止访问。可以和allow指令配合使用。

- 作用域：stream, server
- 语法：deny address | CIDR | unix: | all;

```c
# 禁止192.168.110.1访问
 deny 192.168.110.1;
 
 # 禁止192.168.110.1到192.168.255.254
 deny 192.168.110.0/16;
 
 # 禁止192.168.110.1到192.168.110.254
 deny 192.168.110.0/24;
 
 # 禁止所有的IP访问
 deny all;
```

### 配置示例

禁止所有的IP访问，192.168.110.100除外。

```
allow 192.168.110.100;
 deny all;
```

### 综合案例

只允许192.168.110.100通过Nginx连接MySQL服务器。

```c
stream  {
     allow 192.168.110.100;
     deny all;
     server {
         listen 3306;
         proxy_pass 192.168.110.101:3306;
     }
 }
```



