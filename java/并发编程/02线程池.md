资料来源：https://www.toutiao.com/i7071949384207893027/?tt_from=weixin&utm_campaign=client_share&wxshare_count=1%C3%97tamp=1646700748&app=news_article&utm_source=weixin&utm_medium=toutiao_android&use_new_style=1&req_id=202203080852280101581600282622CD72&share_token=a59cf236-65ab-41d5-8415-4dc0de352cdc&group_id=7071949384207893027&wid=1646701527451


## 线程池

### 多线程原理

**Java线程是不是越多越好?**

1. 线程不仅java 中一个对象，每个线程都有自己的工作内存
  线程的创建、销毁需要时间，消耗性能
  线程过多，会占用很多内存
2. 操作系统需要频繁的切换线程上下文，影响性能
3. 如果创建+ 销毁时间 > 执行时间，就很不合算

线程池的推出，就是为了方便的控制线程数量

**线程池原理：**

1、 **线程池管理器：** 用于创建并管理线程池， 包括创建线程池，销毁线程池， 添加新任务；

2、 **工作线程：** 线程池中线程， 可以循环的执行任务， 在没有任务时处于等待状态；

3、**任务接口：** 每个任务必须实现的接口， 以供工作线程调度任务的执行，它主要规定了任务的

入口， 任务执行完后的收尾工作， 任务的执行状态等；

4、**任务队列：** 用于存放没有处理的任务。 提供一种缓冲机制。

![](https://tva1.sinaimg.cn/large/e6c9d24ely1h1f0un8gjzj20h8061wew.jpg)

线程池 – 类的层次结构

![](https://tva1.sinaimg.cn/large/e6c9d24ely1h1f0v1lgylj20hf095ab9.jpg)

**ExecutorService  接口**

![](https://tva1.sinaimg.cn/large/e6c9d24ely1h1f0vb9m3pj209h05n74y.jpg)



**ScheduledExecutorService 接口**

![](https://tva1.sinaimg.cn/large/e6c9d24ely1h1f0w7ea2uj20hc02b74u.jpg)

**执行过程**

1、是否达到核心线程数量？ 没达到，创建一个工作线程来执行任务。

2、工作队列是否已满？ 没满，则将新提交的任务存储在工作队列里。

3、是否达到线程池最大数量？ 没达到，则创建一个新的工作线程来执行任务。

4、最后， 执行拒绝策略来处理这个任务

![执行过程](https://tva1.sinaimg.cn/large/e6c9d24ely1h1f0xg5rw7j20mp05v0t4.jpg)

###  Executors工具类

你可以自己实例化线程池， 也可以用Executors 创建线程池的工厂类，常用方法如下：

**newFixedThreadPool(int nThreads)** 创建一个固定大小、 任务队列容量无界的线程池。 核心线程数=最大线程数。

**newCachedThreadPool() **创建的是一个大小无界的缓冲线程池。 它的任务队列是一个同步队列。 任务加入到池中， 如果

池中有空闲线程， 则用空闲线程执行，如无则创建新线程执行。 池中的线程空闲超过60秒， 将被销毁释放。 线程数随任

务的多少变化。 适用于执行耗时较小的异步任务。池的核心线程数=0 ， 最大线程数= Integer.MAX_VALUE

**newSingleThreadExecutor() **只有一个线程来执行无界任务队列的单一线程池。 该线程池确保任务按加入的顺序一个一

个依次执行。 当唯一的线程因任务异常中止时，将创建一个新的线程来继续执行后续的任务。 与newFixedThreadPool(1)

的区别在于， 单一线程池的池大小在newSingleThreadExecutor方法中硬编码， 不能再改变的。

**newScheduledThreadPool(intcorePoolSize) **能定时执行任务的线程池。 该池的核心线程数由参数指定，最大线程数=Integer.MAX_VALUE







